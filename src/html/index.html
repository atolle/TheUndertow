<html>

<head>
    <link href="https://fonts.cdnfonts.com/css/zrnic" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/pieces-of-eight" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="images/favicon.ico" />
    <title>The Undertow</title>
</head>

<body>
    <div id="root">
        <div class="row" id="header">
            <div id="nav">
                <a href="#shows">UPCOMING SHOWS</a>
                <a href="#media">OUR MUSIC</a>
                <a href="#about">WHO WE ARE</a>
                <a href="#contact-us">CONTACT US</a>
            </div>
            <div id="logo-container">
                <div id="logo-top">THE</div>
                <div id="logo-bottom-container">
                    <div>UN</div>
                    <div>DERTOW</div>
                </div>
            </div>
            <div id="logo-footer">
                <div>ROCK COVER BAND</div>
            </div>
        </div>
        <div class="row" id="shows">
            <div class="header-center">
                <div>OUR <span id="header-highlight">UPCOMING SHOWS</span></div>
                <div id="sub-header">FOLLOW US ON SOCIAL FOR MOST UP-TO-DATE INFO</div>
            </div>
            <div id="social-container">
                <a href="https://www.facebook.com/people/The-Undertow-Band/100091119876555/" target="_blank">
                    <img class="social-logo" src="images/facebook.png"  />
                </a>
                <!-- <img class="social-logo" src="images/instagram.png" /> -->
                <a href="https://www.youtube.com/channel/UCIlRt3BdlhM8Lgmt2CqWjYw" target="_blank">
                    <img class="social-logo" src="images/youtube.png" />
                </a>
            </div>
            <div id="show-card-container">
            </div>
        </div>
        <div class="row" id="media">
            <div class="header-center">
                <div>OUR MUSIC</div>
            </div>
            <div class="video-container">
                <iframe src="https://www.youtube.com/embed/wMxuoed2oG0" title="YouTube video player" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen>
                </iframe>
            </div>
        </div>
        <div class="row" id="about">
            <div id="about-circle"></div>
            <div id="about-square-top"></div>
            <div id="about-square-bottom"></div>
            <div id="about-header-container">
                <div id="about-header">WHO ARE WE?</div>
            </div>
            <div id="about-verbiage-container">
                <div id="about-verbiage">
                    THE UNDERTOW is a four-piece rock cover band, formed in 2022, and based in Gulf Shores, AL.
                    <br /><br />
                    The members all come from a mix of geographic locations, bringing with them decades of musical
                    experience, honed in a variety of original and cover groups. Born out of a desire to play something
                    different than the usual, THE UNDERTOW specializes in 1990's - 2000's alternative/grunge rock, with
                    some surprises always thrown in for good measure.
                    <br /><br />
                    No venue too big, no venue too small, because we cover it all! Come out and see us.
                    <br /><br />
                    THE UNDERTOW... We'll put you in!
                </div>
            </div>
            <div id="about-subheader-container">
                <div id="about-subheader-verbiage">THE BAND</div>
                <div id="about-subheader-square"></div>
            </div>
            <div id="about-band-container">
                <img id="about-band-image" src="images/theundertow-beach-march-2023.jpg" />
                <div id="about-band-verbiage">
                    <span id="about-band-header">THE UNDERTOW IS</span>
                    <br />
                    <br />
                    Mike - Drums
                    <br />
                    <br />
                    Andrew - Bass
                    <br />
                    <br />
                    Pete - Guitar & vocals
                    <br />
                    <br />
                    Bryan - Guitar & vocals
                </div>
            </div>
        </div>
        <div class="row" id="book-us">
            <div id="book-us-header-container">
                <div id="book-us-header">BOOK<br />US</div>
            </div>
            <div id="book-us-verbiage-container">
                <div id="book-us-verbiage">WE DO PUBLIC AND<br />PRIVATE EVENTS.</div>
            </div>
        </div>
        <div class="row" id="contact-us">
            <div class="header-center" id="contact-us-header">
                NOW BOOKING FOR 2023
            </div>
            <div id="contact-us-success">
                Thanks for reach out! We'll get back to you ASAP.
            </div>
            <form id="contact-us-form">
                <div id="contact-us-error"></div>
                <input form="contact-us-form" id="name" name="name" type="text" placeholder="Name" />
                <input form="contact-us-form" id="email" name="email" type="text" placeholder="Email" />
                <textarea form="contact-us-form" id="message" name="message" placeholder="Message"></textarea>
                <button class="button" id="send-button">SEND</button>
            </form>
        </div>
    </div>
</body>

</html>

<script>
    const jumpToShow = (href) => {
        window.open(href);
    }

    const fetchAndDrawShows = async () => {
        const showCardContainer = document.getElementById("show-card-container");
        const response = await fetch("/json/shows.json", {
            method: "GET",
            headers: { 'Content-Type': 'application/json' },
            cache: "no-store"
        });

        let showsHtml = `
                <div class="show-card">
                    <div class="show-circle"></div>
                    <div class="show-date"></div>
                    <div class="show-venue">More shows coming soon!</div>
                    <div class="show-location"></div>
                    <div class="show-time"></div>
                </div>
            `

        if (response.ok) {
            const shows = await response.json();

            if (shows.length) {
                showsHtml = "";

                for (const show of shows) {
                    showsHtml += `
                            <div class="show-card" onclick="jumpToShow('${show.href}')">
                                <div class="show-circle"></div>
                                <div class="show-date">${show.date}</div>
                                <div class="show-venue">${show.venue}</div>
                                <div class="show-location">${show.location}</div>
                                <div class="show-time">${show.time}</div>
                            </div>
                        `
                }
            }
        }

        showCardContainer.innerHTML = showsHtml;
    }

    document.addEventListener("DOMContentLoaded", () => {
        const contactForm = document.getElementById("contact-us-form");
        const conactUsSuccess = document.getElementById("contact-us-success");
        const contactUsError = document.getElementById("contact-us-error");
        const sendButton = document.getElementById("send-button");
        const nameField = document.getElementById("name");
        const emailField = document.getElementById("email");
        const messageField = document.getElementById("message");

        const formIsValid = () => {
            let formIsValid = true;

            if (!nameField.value) {
                formIsValid = false;
                nameField.classList.add("has-error");
            }

            if (!emailField.value) {
                formIsValid = false;
                emailField.classList.add("has-error");
            }

            if (!messageField.value) {
                formIsValid = false;
                messageField.classList.add("has-error");
            }

            return formIsValid;
        }

        document.addEventListener('keydown', (event) => {
            if (event.target.matches("#name")) {
                contactUsError.style.display = "none";
                nameField.classList.remove("has-error");
            }

            if (event.target.matches("#email")) {
                contactUsError.style.display = "none";
                emailField.classList.remove("has-error");
            }

            if (event.target.matches("#message")) {
                contactUsError.style.display = "none";
                messageField.classList.remove("has-error");
            }
        });

        document.addEventListener('click', (event) => {
            if (event.target === sendButton) {
                event.preventDefault();

                if (!formIsValid()) {
                    contactUsError.innerHTML = "Please fill out all fields.";
                    contactUsError.style.display = "block";
                    return;
                }

                const formData = new FormData(contactForm);
                const payload = {};

                formData.forEach((value, key) => (payload[key] = value));

                contactUsError.style.display = "none";
                sendButton.disabled = true;
                sendButton.innerHTML = "SENDING...";

                fetch("/contact", {
                    method: "POST",
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                }).then((response) => {
                    if (response.ok) {
                        contactForm.style.display = "none";
                        conactUsSuccess.style.display = "block";
                        return;
                    }

                    contactUsError.innerHTML = "Unable to send email. Please try again.";
                    contactUsError.style.display = "block";
                    sendButton.disabled = false;
                    sendButton.innerHTML = "SEND";
                });
            }
        }, false);

        contactForm.reset();
        fetchAndDrawShows();
    });
</script>